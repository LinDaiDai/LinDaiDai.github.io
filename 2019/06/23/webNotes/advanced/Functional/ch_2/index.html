<!DOCTYPE html>
<html lang="en">




<head><meta name="generator" content="Hexo 3.8.0">

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  
      <title>霖呆呆的函数式编程之路(二) - LinDaiDai</title>
  

  
  
  <meta name="description" content="">
  <meta name="author" content="LinDaiDai">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- load loadjs.js -->
  <script src="/libs/loadjs/dist/loadjs.min.js"></script>

<link rel="stylesheet" href="/libs/animate.css/animate.min.css">
  <!-- load lightgallery -->
<link rel="stylesheet" href="/css/lightgallery.css">
<link rel="stylesheet" href="/libs/noty/lib/noty.css">
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  






    <link rel="stylesheet" href="/css/taurus.css">
    


<link rel="stylesheet" href="/.css">

  <!-- load font awesome 5 -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
  </script>
  <!-- load mathjax -->
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax//libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <!-- load js-cookie -->
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="/js/social-share.min.js"></script>
    <script src="/js/theme.js"></script>

  <!-- include cookie.js -->
  
  

  <!-- include comment system code -->
  
  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/images/wang.png">
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh;">

 

<header id="header" class="header">
	<div class="header-title">
		
		<div class="header-text-no-image">
			<h1>
				<a href="/">LinDaiDai</a>
			</h1>
			<subtitle>王霈霖的个人博客</subtitle>
		</div>
		
	</div>
	<div id="header-nav">
		



<nav id="nav">
	
	
	
	<div class="nav-item" id="nav-item-toc">
		


<div class="toc-container">
<i class="far fa-times-circle" id="toc-close" onclick="closeTOC(event);" ontouchstart="closeTOC(event);"></i>

</div>
<div class="toc-button" onclick="toggleTOC(event);" ontouchstart="toggleTOC(event);">
    <img src="/images/icons//toc.svg" alt="">
</div>

	</div>
	
	<div class="nav-item" id="nav-item-archive">
		
				<div class="nav-icon">
				
			<a href="/archives/" title="归档">
			<img src="/images/icons//archive.svg" alt="">
			</a>
		</div>
	</div>
	<div class="nav-item" id="nav-item-search">
		
		<div class="nav-icon">
		
			<a href="/search/" title="搜索">
			<img src="/images/icons//search.svg" alt="">
			</a>
		</div>
	</div>
	<div class="nav-item" id="nav-item-more">
		<div class="nav-icon">
				<a href="#" onclick="onClickMenuIcon(event);" ontouchstart="onClickMenuIcon(event);">
				<img src="/images/icons//menu.svg" alt="">
				</a>
		</div>
		<div class="nav-more-menu">
				<i class="far fa-times-circle" id="nav-more-menu-close" onclick="onClickNavMenuClose(event);" ontouchstart="onClickNavMenuClose(event);"></i>
		
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/php/">
						<span>Php</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/mySql/">
						<span>Mysql</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/其它技能/">
						<span>其它技能</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/vscode/">
						<span>Vscode</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/前端进阶/">
						<span>前端进阶</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/前端入门/">
						<span>前端入门</span>
					</a>
				</div>
		</div>
		
	</div>
	</div>
</nav>

	</div>
</header>

 

  




  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div style="flex: 1;">
      <style>
    body {
        background-color: white;
    }
</style>




	
	
	
	



    
        
            
            
        
    






    









<article class="article" id="/2019/06/23/webNotes/advanced/Functional/ch_2/" data-name="霖呆呆的函数式编程之路(二)" data-version="">

    <!-- Title -->
    <div class="article-header">
         
         <div class="article-logo">
            <a href="#" data-no-instant="">
                <img src="/images/前端进阶.svg" alt="" onerror="if(this.src != " images="" uncategorized.svg")="" this.src="/images/uncategorized.svg" "="">
            </a>
         </div>
         
         <h1 class="article-title">
            <a href="/2019/06/23/webNotes/advanced/Functional/ch_2/">
                霖呆呆的函数式编程之路(二)
            </a>
        </h1>
        <!-- TODO: support nested categories,display them nicely -->
        
        <ul class="article-categories">
            
            
                <li><a href="/categories/前端进阶/" data-no-instant="">
                    <img src="/images/前端进阶.svg" alt="前端进阶" onerror="if(this.src != " images="" uncategorized.svg")="" this.src="/images/uncategorized.svg" "="" title="前端进阶">
                </a></li>
            
        </ul>
        
    </div>
    
    <!-- Date and Author -->
    <div class="article-meta">
    <ul>
            <li><i class="fa fa-calendar"></i> 2019年06月23日</li>
            
            <li class="comment-button"><a href="#article-comment"><i class="fa fa-comments"></i> <span id="article-comment-count">0</span></a></li>
            <li><i class="fa fa-eye"></i> <span id="article-visit-count">0</span></li>
            <li class="thumb-up-button" id="thumb-up-button"><i class="far fa-thumbs-up fa-lg" id="thumb-up-icon"></i> <span id="article-thumbup-count">0</span></li>
            
            <li><i class="fa fa-user"></i> LinDaiDai</li>
            <li><i class="fas fa-copyright"></i>
            
                
                
            
            
                
                <a href="mailto:">禁止转载</a>
            
            </li>
    </ul>
    
<div class="tags">
	
		
			<label class="tag-1"><a href="/tags/Functional/">Functional</a></label>
		
	
		
			<label class="tag-2"><a href="/tags/前端进阶/">前端进阶</a></label>
		
	
	</div>

    </div>
    <div class="article-cards">
        <!-- Author Card -->
        <!---
        <div class='Card-article Card-author'>
            <div class='card-title'>
                <h3></h3>
            </div>
            <div class='card-content'>
                    <div class="author-meta">
                            <div class='author-figure'>
                                <img src="" alt="">
                            </div>
                            <div class='author-name'>
                                LinDaiDai
                            </div>
                        </div>
                        <div class="author-ai">
                            <div class='author-intro'>
                                <!-- TODO: auto generating author description -->
                                <!-- 
                            </div>
                            <div class="author-articles">
                                <!-- TODO: auto generating author articles -->
                                <!-- <ul>
                                    <li>Article 1</li>
                                    <li>Article 2</li>
                                    <li>Article 3</li>
                                    <li>Article 4</li>
                                    <li>Article 5</li>
                                    <li>Article 6</li>
                                </ul>
                            </div>
                        </div>
            </div>
            
        </div> -->

        <!-- Visit Card -->
        <!-- <div class="Card-article Card-visit"> -->
            <!-- <div class="card-title">
  <h3>Post Visit</h3>
</div>
<div class="card-chart">
  <div id="chart-post-visit"></div>
</div> -->
        <!-- </div> -->
        
        <!-- Auto Excerpt Card -->
        <!-- <div class="Card-article Card-excerpt">
            <div class="card-title">
  <h3>Quick Read</h3>
</div>
<div class="card-text">
  <p id="text-post-summary">...</p>
</div>
        </div> -->
    </div>
    
    <!-- Gallery -->
    <!-- TODO: add a slider to gallery -->
    

    <!-- Content -->
    <!-- TODO: support table of content -->
    <div class="article-toc" id="article-toc">
    
        


<div class="toc-container">
<i class="far fa-times-circle" id="toc-close" onclick="closeTOC(event);" ontouchstart="closeTOC(event);"></i>

</div>
<div class="toc-button" onclick="toggleTOC(event);" ontouchstart="toggleTOC(event);">
    <img src="/images/icons//toc.svg" alt="">
</div>

    </div>
    <div class="article-content">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在第一章我们主要介绍了函数的一些基本功能和结构，以及介绍了一些实用的小技巧。这些都是为了后面一步一步入门打下好的基础。因为函数式编程并不是一个看看文档就能很好掌握的东西，它需要你集合实际例子然后理解每一步为什么要这样，如果你只是想粗略的看看，不去思考🤔，相信我，后面的案例你会感觉特别跳，特别绕(开始学习时我就是这样😼)。</p>
<p>在这一章中，我会针对函数式编程的另一个重点：<strong>函数的输入</strong>来做讲解和案例分析，个人建议：打开你的<code>vscode</code>，关上文档，把案例敲上一遍，需要的时候把每一步做个对比，确保自己是真的理解它们。</p>
<h2 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h2><p>先来看一个大家都很熟悉的函数：</p>
<ol>
<li>一个<code>ajax</code>函数，第一个参数为请求的<code>API</code>地址，第二个为请求的参数，第三个是请求成功之后的回调函数。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">url, data, callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>现在如果你已经很确定一个<code>API</code>地址，此外只是需要等待另外两个参数的时候，比如获取用户信息和获取订单详情的请求：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span> (<span class="params">data, cb</span>) </span>&#123;</span><br><span class="line">	ajax(<span class="string">'/api/user'</span>, data, cb)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOrder</span> (<span class="params">data, cb</span>) </span>&#123;</span><br><span class="line">	ajax(<span class="string">'api/order'</span>, data, cb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>现在如果你已经很确定一个<code>API</code>地址，同时已经很确定请求的参数(比如用户的<code>id</code>)，此外只需要等待另一个参数的时候：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentUser</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">	getUser(&#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;, cb)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentOrder</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">	getUser(&#123; <span class="attr">orderId</span>: <span class="number">1</span> &#125;, cb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不知道大家发现了没，从第一步到第三步，每过一步，函数的参数就少一个，直到最后只需要传递一个<code>cb</code>。</p>
<p>用一句话来说明发生的事情：<code>getUser(data, cb)</code>是<code>ajax(url, data, cb)</code>的<strong>偏函数(partially-applied functions)</strong>。</p>
<p>(注意⚠️：前方高能！)</p>
<p>关于该模式更正式的说法是：偏函数严格来讲是一个减少函数参数个数（arity）的过程；这里的参数个数指的是希望传入的形参的数量。我们通过 <code>getUser(..)</code> 把原函数 <code>ajax(..)</code> 的参数个数从 3 个减少到了 2 个。</p>
<h3 id="partial函数"><a href="#partial函数" class="headerlink" title="partial函数"></a>partial函数</h3><p>在上面的例子中，<code>getCurrentUser(cb)</code>和<code>getCurrentOrder(cb)</code>的模式其实很想，我们可以来定一个<code>partial()</code>实用函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">partial</span> (<span class="params">fn, ...prestArgs</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">partiallyApplied</span> (<span class="params">...laterArgs</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fn(...prestArgs, ...laterArgs)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>partial</code>函数接受一个<code>fn</code>函数，和若干个参数<code>…prestArgs</code>。</p>
<p>它返回的是另一个函数<code>partiallyApplied()</code>函数，这个函数也接受若干个参数<code>…laterArgs</code>，并返回<code>partial</code>函数传递进来<code>fn</code>函数。</p>
<p>返回的<code>fn</code>函数会将<code>partial</code>和<code>partiallyApplied</code>中的参数都接收过去。</p>
<p>(这个实用函数我至少敲了3遍…)</p>
<p>好吧，我们还是来看看我参考资料的原版本是怎么描述这个实用函数的吧，感觉它说的也比较清晰：</p>
<blockquote>
<p><code>partial(..)</code> 函数接收 <code>fn</code> 参数，来表示被我们偏应用实参（partially apply）的函数。接着，<code>fn</code> 形参之后，<code>presetArgs</code> 数组收集了后面传入的实参，保存起来稍后使用。</p>
<p>我们创建并 <code>return</code> 了一个新的内部函数（为了清晰明了，我们把它命名为<code>partiallyApplied(..)</code>），该函数中，<code>laterArgs</code> 数组收集了全部实参。</p>
<p>你注意到在内部函数中的 <code>fn</code> 和 <code>presetArgs</code> 引用了吗？他们是怎么如何工作的？在函数 <code>partial(..)</code> 结束运行后，内部函数为何还能访问 <code>fn</code> 和 <code>presetArgs</code> 引用？你答对了，就是因为<strong>闭包</strong>！内部函数 <code>partiallyApplied(..)</code> 封闭（closes over）了 <code>fn</code> 和 <code>presetArgs</code> 变量，所以无论该函数在哪里运行，在 <code>partial(..)</code> 函数运行后我们仍然可以访问这些变量。所以理解闭包是多么的重要！</p>
<p>当 <code>partiallyApplied(..)</code> 函数稍后在某处执行时，该函数使用被闭包作用（closed over）的 <code>fn</code> 引用来执行原函数，首先传入（被闭包作用的）<code>presetArgs</code> 数组中所有的偏应用（partial application）实参，然后再进一步传入 <code>laterArgs</code> 数组中的实参。</p>
</blockquote>
<p>当然你也可以用更便捷的箭头函数语法来重写上面的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> partial = <span class="function">(<span class="params">fn, ...presetArgs</span>) =&gt;</span> </span><br><span class="line">														(...laterArgs) =&gt; </span><br><span class="line">																fn(...prestArgs, ...laterArgs);</span><br></pre></td></tr></table></figure>
<p><strong>优点</strong>：更加简洁，甚至代码稀少。</p>
<p><strong>缺点</strong>：函数会变成匿名函数，可读性上失去益处，此外，由于作用域边界变得模糊，我们会更加难以辩认闭包。</p>
<p>不过是否采用箭头函数都是你的个人喜好。</p>
<h3 id="ajax案例"><a href="#ajax案例" class="headerlink" title="ajax案例"></a>ajax案例</h3><ol>
<li>介绍完上面的函数，我们现在可以用<code>partial</code>实用函数来制造这些之前提及的偏函数：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">partial</span> (<span class="params">fn, ...prestArgs</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">partiallyApplied</span> (<span class="params">...laterArgs</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fn(...prestArgs, ...laterArgs)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getUser = partial(ajax, <span class="string">'/api/user'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getOrder = partial(ajax, <span class="string">'/api/order'</span>)</span><br></pre></td></tr></table></figure>
<p>不知道大家脑中是否有<code>getUser</code> 函数的外形和内在，它其实就相当于这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getUser = partial(ajax, <span class="string">'/api/user'</span>)</span><br><span class="line"><span class="comment">// 相当于=&gt;</span></span><br><span class="line"><span class="keyword">var</span> getUser = <span class="function"><span class="keyword">function</span> <span class="title">partailApplication</span> (<span class="params">...laterArgs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ajax(<span class="string">'/api/user'</span>, ...laterArgs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>我相信大家已经知道怎样用<code>partial</code>来写<code>getUser</code>函数了</li>
</ol>
<p>那么再进一层，<code>getCurrentuser</code>函数可以怎么写呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example2</span></span><br><span class="line"><span class="keyword">var</span> getCurrentUser = partial(ajax, <span class="string">'/api/user'</span>, &#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;)</span><br></pre></td></tr></table></figure>
<p>哈哈😄，看到这里你是否想到了还能用案例1中的<code>getUser</code>和<code>partial</code>配合：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example3</span></span><br><span class="line"><span class="keyword">var</span> getCurrentUser = partial(getUser, &#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;)</span><br></pre></td></tr></table></figure>
<p>过程是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">url, data, callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">partial</span> (<span class="params">fn, ...prestArgs</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">partiallyApplied</span> (<span class="params">...laterArgs</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fn(...prestArgs, ...laterArgs)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getUser = partial(ajax, <span class="string">'/api/user'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getCurrentUser = partial(getUser, &#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;)</span><br></pre></td></tr></table></figure>
<p>我们可以像案例2一样通过指定<code>url</code>和<code>data</code>两个实参来定义<code>getCurrentUser(...)</code>函数。</p>
<p>也可以像案例3将<code>getCurrentUser(…)</code>函数定义成<code>getUser(…)</code>的偏应用，该偏应用仅指定一个附加的 <code>data</code> 实参。</p>
<blockquote>
<p>案例3的函数包含了一个额外的函数包装层。这看起来有些奇怪而且多余，但对于你真正要适应的函数式编程来说，这仅仅是它的冰山一角。随着本文的继续深入，我们将会把许多函数互相包装起来。记住，这就是<strong>函数</strong>式编程！</p>
</blockquote>
<h3 id="add案例"><a href="#add案例" class="headerlink" title="add案例"></a>add案例</h3><p>理解了上面的一个案例之后，我们再来看下面的案例应该就会变得非常简单了：</p>
<p>这是一个计算返回两数之和的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们有一个数组，要给数组中的每一项都固定加上一个数<code>3</code>，也许你想到了可以用<code>JS</code>中的<code>map</code>来写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">var</span> arr2 = arr.map(<span class="function"><span class="keyword">function</span> <span class="title">adder</span> (<span class="params">val</span>) =&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> add(<span class="number">3</span>, val)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>map</code>中执行的事情其实也是返回一个函数<code>add</code>的计算结果，那么我们就可以用<code>partial</code>函数来写它：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example4</span></span><br><span class="line"><span class="keyword">var</span> arr2 = arr.map(partial(add, <span class="number">3</span>))</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> 如果你没见过 <code>map(..)</code> ，别担心，我会在后面的部分详细介绍它。目前你只需要知道它用来循环遍历（loop over）一个数组，在遍历过程中调用函数产出新值并存到新的数组中。</p>
<h2 id="右偏函数"><a href="#右偏函数" class="headerlink" title="右偏函数"></a>右偏函数</h2><p>在上面的<code>ajax</code>案例中，我们是先传递<code>url</code>和<code>data</code>，最后再确定<code></code>c<code>的，如果要偏应用</code>cb<code>而稍后再指定</code>data<code>和</code>url` 参数，我们应该怎么做呢？</p>
<h3 id="reverseArgs函数"><a href="#reverseArgs函数" class="headerlink" title="reverseArgs函数"></a>reverseArgs函数</h3><p>我们可以创建一个可以颠倒实参顺序的实用函数，用来包装原函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverseArgs</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">argsReversed</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fn(...args.reverse())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 箭头函数形式</span></span><br><span class="line"><span class="keyword">var</span> reverseArgs =</span><br><span class="line">	fn =&gt;</span><br><span class="line">		(...args) =&gt;</span><br><span class="line">			fn( ...args.reverse() )</span><br></pre></td></tr></table></figure>
<p>该函数的作用很简单，它可以颠倒实参顺序。</p>
<h3 id="partialRight函数"><a href="#partialRight函数" class="headerlink" title="partialRight函数"></a>partialRight函数</h3><p>现在我们来定义一个从右边开始偏应用实参的<code>partialRight</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">partialRight</span>(<span class="params"> fn, ...presetArgs </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> reverseArgs(</span><br><span class="line">		partial( reverseArgs( fn ), ...presetArgs.reverse() )</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 <code>partialRight(..)</code> 函数的实现方案不能保证让一个特定的形参接收特定的被偏应用的值；它只能确保将被这些值（一个或几个）当作原函数最右边的实参（一个或几个）传入。</p>
<p>比如说：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x,y,z</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> rest = [].slice.call( <span class="built_in">arguments</span>, <span class="number">3</span> );</span><br><span class="line">	<span class="built_in">console</span>.log( x, y, z, rest );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = partialRight( foo, <span class="string">"z:last"</span> );</span><br><span class="line"></span><br><span class="line">f( <span class="number">1</span>, <span class="number">2</span> );			<span class="comment">// 1 2 "z:last" []</span></span><br><span class="line"></span><br><span class="line">f( <span class="number">1</span> );				<span class="comment">// 1 "z:last" undefined []</span></span><br><span class="line"></span><br><span class="line">f( <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> );		<span class="comment">// 1 2 3 ["z:last"]</span></span><br><span class="line"></span><br><span class="line">f( <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> );	<span class="comment">// 1 2 3 [4,"z:last"]</span></span><br></pre></td></tr></table></figure>
<p>只有在传两个实参（匹配到 <code>x</code> 和 <code>y</code> 形参）调用 <code>f(..)</code> 函数时，<code>&quot;z:last&quot;</code> 这个值才能被赋给函数的形参 <code>z</code>。在其他的例子里，不管左边有多少个实参，<code>&quot;z:last&quot;</code> 都被传给最右的实参。</p>
<h2 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h2><p>我们来看一个跟偏应用类似的技术，该技术将一个期望接收多个实参的函数拆解成连续的链式函数（chained functions），每个链式函数接收单一实参（实参个数：1）并返回另一个接收下一个实参的函数。</p>
<p>这就是柯里化（currying）技术。</p>
<p>还记得前面的<code>ajax</code>函数吗？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">url, data, callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在想象一下我们已经创建了一个<code>ajax(…)</code>的柯里化版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curriedAjax(<span class="string">'/api/user'</span>)</span><br><span class="line">						(&#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;)</span><br><span class="line">							( <span class="function"><span class="keyword">function</span> <span class="title">foundUser</span>(<span class="params">user</span>) </span>&#123; ... &#125; )</span><br></pre></td></tr></table></figure>
<p>我们将三次调用分别拆解开来，这也许有助于我们理解整个过程：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userFetcher = curriedAjax(<span class="string">'/api/user'</span>)</span><br><span class="line"><span class="keyword">var</span> getCurrentUser = userFetcher(&#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;)</span><br><span class="line">getCurrentUser( <span class="function"><span class="keyword">function</span> <span class="title">foundUser</span>(<span class="params">user</span>)</span>&#123; <span class="comment">/* .. */</span> &#125; )</span><br></pre></td></tr></table></figure>
<p>可以看到<code>curriedAjax</code>函数在每次调用的时候只接收一个实参，而不是一次性接收所有实参（像 <code>ajax(..)</code> 那样），也不是先传部分实参再传剩余部分实参（借助 <code>partial(..)</code> 函数）。</p>
<p><strong>柯里化和偏应用进行对比</strong>：</p>
<p>相同点：</p>
<ul>
<li>每个类似偏应用的连续柯里化调用都把另一个实参应用到原函数，一直到所有实参传递完毕。</li>
</ul>
<p>不同点：</p>
<ul>
<li>柯里化会明确地返回一个期望<strong>只接收下一个实参</strong> <code>data</code> 的函数，而偏应用是能接收所有的剩余参数。</li>
</ul>
<h3 id="curry函数"><a href="#curry函数" class="headerlink" title="curry函数"></a>curry函数</h3><p>下面我们来看看如何定义一个用来柯里化的实用函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn, arity = fn.length</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span> <span class="title">nextCurried</span>(<span class="params">prevArgs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">curried</span>(<span class="params">nextArg</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> args = prevArgs.concat([nextArg])</span><br><span class="line">      <span class="keyword">if</span> (args.length &gt;= arity) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn(...args)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nextCurried(args)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)([])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ES6</code>箭头函数版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curry = <span class="function">(<span class="params">fn, arity = fn.length, nextCurried</span>) =&gt;</span> </span><br><span class="line">								(nextCurried = <span class="function"><span class="params">prevArgs</span> =&gt;</span> &#123;</span><br><span class="line">									nextArg =&gt; &#123;</span><br><span class="line">										<span class="keyword">var</span> args = prevArgs.concat( [nextArg] );</span><br><span class="line">                    <span class="keyword">if</span> (args.length &gt;= arity) &#123;</span><br><span class="line">                      <span class="keyword">return</span> fn( ...args );</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                      <span class="keyword">return</span> nextCurried( args );</span><br><span class="line">                    &#125;</span><br><span class="line">									&#125;</span><br><span class="line">								&#125;)([])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处的实现方式是把空数组 <code>[]</code> 当作 <code>prevArgs</code> 的初始实参集合，并且将每次接收到的 <code>nextArg</code> 同 <code>prevArgs</code> 连接成 <code>args</code> 数组。当 <code>args.length</code> 小于 <code>arity</code>（原函数 <code>fn(..)</code> 被定义和期望的形参数量）时，返回另一个 <code>curried(..)</code>函数（译者注：这里指代 <code>nextCurried(..)</code> 返回的函数）用来接收下一个 <code>nextArg</code> 实参，与此同时将 <code>args</code> 实参集合作为唯一的 <code>prevArgs</code> 参数传入 <code>nextCurried(..)</code> 函数。一旦我们收集了足够长度的 <code>args</code> 数组，就用这些实参触发原函数 <code>fn(..)</code>。</p>
<p>默认地，我们的实现方案基于下面的条件：在拿到原函数期望的全部实参之前，我们能够通过检查将要被柯里化的函数的 <code>length</code> 属性来得知柯里化需要迭代多少次。</p>
<p>假如你将该版本的 <code>curry(..)</code> 函数用在一个 <code>length</code> 属性不明确的函数上 —— 函数的形参声明包含默认形参值、形参解构，或者它是可变参数函数，用 <code>...args</code> 当形参；参考第 2 章 —— 你将要传入 <code>arity</code> 参数（作为 <code>curry(..)</code> 的第二个形参）来确保 <code>curry(..)</code> 函数的正常运行。</p>
</blockquote>
<h3 id="ajax案例-1"><a href="#ajax案例-1" class="headerlink" title="ajax案例"></a>ajax案例</h3><p>我们用 <code>curry(..)</code> 函数来实现此前的 <code>ajax(..)</code> 例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curriedAjax = curry( ajax )</span><br><span class="line"><span class="keyword">var</span> userFetcher = curriedAjax(<span class="string">'/api/user'</span>)</span><br><span class="line"><span class="keyword">var</span> getCurrentUser = userFetcher(&#123; <span class="attr">userId</span>: <span class="number">1</span> &#125;)</span><br><span class="line">getCurrentUser( <span class="function"><span class="keyword">function</span> <span class="title">foundUser</span>(<span class="params">user</span>)</span>&#123; <span class="comment">/* .. */</span> &#125; )</span><br></pre></td></tr></table></figure>
<p>可以看到在每次函数调用的时候都会新增一个实参，最终给原函数<code>ajax</code>使用，直到收齐了三个实参并执行<code>ajax</code>函数为止。</p>
<h3 id="add案例-1"><a href="#add案例-1" class="headerlink" title="add案例"></a>add案例</h3><p>现在我们还可以来回顾一下在<code>partial</code>中用到的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">var</span> arr2 = arr.map( partial(add, <span class="number">3</span>) )</span><br></pre></td></tr></table></figure>
<p>由于柯里化是和偏应用相似的，所以我们可以用几乎相同的方式以柯里化来完成那个例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr2 = arr.map( curry( add )( <span class="number">3</span> ) );</span><br><span class="line"><span class="comment">// [4,5,6,7,8]</span></span><br></pre></td></tr></table></figure>
<p><code>partial(add,3)</code> 和 <code>curry(add)(3)</code> 两者有什么不同呢？为什么你会选 <code>curry(..)</code> 而不是偏函数呢？当你先得知 <code>add(..)</code> 是将要被调整的函数，但如果这个时候并不能确定 <code>3</code> 这个值，柯里化可能会起作用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> adder = curry( add );</span><br><span class="line"></span><br><span class="line"><span class="comment">// later</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].map( adder( <span class="number">3</span> ) );</span><br><span class="line"><span class="comment">// [4,5,6,7,8]</span></span><br></pre></td></tr></table></figure>
<h3 id="sum案例"><a href="#sum案例" class="headerlink" title="sum案例"></a>sum案例</h3><p>下面这个案例，是将一个列表的数字相加：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">		sum += args[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>普通调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>柯里化调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (5 用来指定需要链式调用的次数)</span></span><br><span class="line"><span class="keyword">var</span> curriedSum = curry( sum, <span class="number">5</span> )</span><br><span class="line">curriedSum( <span class="number">1</span> )( <span class="number">2</span> )( <span class="number">3</span> )( <span class="number">4</span> )( <span class="number">5</span> ) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>柯里化调用的好处：</p>
<ul>
<li>每次函数调用传入一个实参，并生成另一个特定性更强的函数，之后我们可以在程序中获取并使用<strong>那个</strong>新函数。</li>
<li>偏应用则是预先指定所有将被偏应用的实参，产出一个等待接收剩下所有实参的函数。</li>
</ul>
<h2 id="柯里化和偏应用有什么用？"><a href="#柯里化和偏应用有什么用？" class="headerlink" title="柯里化和偏应用有什么用？"></a>柯里化和偏应用有什么用？</h2><p>柯里化和偏应用这两种风格的签名都比普通的函数要奇怪很多，那么为什么要用这么奇怪的方式去构造那些函数呢？主要是有这么几个方面：</p>
<ul>
<li>使用柯里化和偏应用可以将指定分离实参的时机和地方独立开来，传统函数是需要预先确定所有实参的。</li>
<li>当函数只有一个形参时，我们能够比较容易地组合它们</li>
</ul>
<h2 id="柯里化多个参数"><a href="#柯里化多个参数" class="headerlink" title="柯里化多个参数"></a>柯里化多个参数</h2><p>在上面介绍的函数柯里化中，我们知道，它在每次调用的时候只支持传入一个实参。这样的柯里化我们可以称之为“严格柯里化”。</p>
<h3 id="looseCurry函数"><a href="#looseCurry函数" class="headerlink" title="looseCurry函数"></a>looseCurry函数</h3><p>其实在大多数流行的<code>JavaScript</code>函数式编程都使用了一种不严格的柯里化(loose currying)。</p>
<p>也就是说，往往 JS 柯里化实用函数会允许你在每次柯里化调用中指定多个实参，如在上面提到的<code>sum</code>函数，我们使用严格柯里化需要调用5次，但在松散柯里化我们可以这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curriedSum = looseCurry(sum, <span class="number">5</span>)</span><br><span class="line">curriedSum(<span class="number">1</span>)(<span class="number">2</span>, <span class="number">3</span>)(<span class="number">4</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>相比于严格的柯里化，语法上我们节省了<code>()</code>的使用，并且把五次函数调用减少成三次，间接提高了性能。</p>
<p><strong>注意：</strong> 松散柯里化<strong>允许</strong>你传入超过形参数量（arity，原函数确认或指定的形参数量）的实参。如果你将函数的参数设计成可配的或变化的，那么松散柯里化将会有利于你。</p>
<p>现在我们可以将之前的柯里化函数调整一下，使其适应这种常见的更松散的定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">looseCurry</span> (<span class="params">fn, arity = fn.length</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span> <span class="title">nextCurried</span> (<span class="params">prevArgs</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">curried</span>(<span class="params">...nextArgs</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> args = prevArgs.concat(nextArgs)</span><br><span class="line">            <span class="keyword">if</span> (args.length &gt;= arity) &#123;</span><br><span class="line">                <span class="keyword">return</span> fn(...args)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> nextCurried(args)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)([])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ES6</code>版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> looseCurry = <span class="function">(<span class="params">fn, arity = fn.length, nextCurried</span>) =&gt;</span></span><br><span class="line">    (nextCurried = <span class="function"><span class="params">prevArgs</span> =&gt;</span></span><br><span class="line">        (...nextArg) =&gt; &#123;</span><br><span class="line">            <span class="keyword">var</span> args = prevArgs.concat(nextArg);</span><br><span class="line">            <span class="keyword">if</span> (args.length &gt;= arity) &#123;</span><br><span class="line">                <span class="keyword">return</span> fn(...args);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> nextCurried(args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)([])</span><br></pre></td></tr></table></figure>
<h2 id="反柯里化"><a href="#反柯里化" class="headerlink" title="反柯里化"></a>反柯里化</h2><p>你也会遇到这种情况：拿到一个柯里化后的函数，却想要它柯里化之前的版本 —— 这本质上就是想将类似 <code>f(1)(2)(3)</code> 的函数变回类似 <code>g(1,2,3)</code> 的函数。</p>
<h3 id="uncurry函数"><a href="#uncurry函数" class="headerlink" title="uncurry函数"></a>uncurry函数</h3><p>处理这个需求的标准实用函数通常被叫作 <code>uncurry(..)</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uncurry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">uncurried</span>(<span class="params">...args</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> ret = fn;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">			ret = ret( args[i] );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ES6</code>版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uncurry = <span class="function"><span class="params">fn</span> =&gt;</span> </span><br><span class="line">	uncurried = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> ret = fn</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">			ret = ret( args[i] )</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>使用反柯里化后，可以让我们函数的传参形式变为柯里化之前的形式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">		sum += args[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> curriedSum = curry( sum, <span class="number">5</span> );</span><br><span class="line"><span class="keyword">var</span> uncurriedSum = uncurry( curriedSum );</span><br><span class="line"></span><br><span class="line">curriedSum( <span class="number">1</span> )( <span class="number">2</span> )( <span class="number">3</span> )( <span class="number">4</span> )( <span class="number">5</span> );		<span class="comment">// 15</span></span><br><span class="line">uncurriedSum( <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> );				<span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p><strong>注意⚠️</strong></p>
<p>但不要以为使用了反柯里化之后的函数会和原函数的行为完全一样(也就是uncurry(curry(fn))和 fn )，虽然在某些库中，反柯里化使函数变成和原函数（译者注：这里的原函数指柯里化之前的函数）类似的函数。</p>
<p>但是凡事皆有例外，例如我们上面的案例5，采用反柯里化之后，如果你少传了实参，就会得到一个仍然在等待传入更多实参的部分柯里化函数。我们在下面的代码中说明这个怪异行为。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uncurriedSum( <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> ) <span class="comment">// 15</span></span><br><span class="line">uncurriedSum( <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> )( <span class="number">4</span>, <span class="number">5</span> ) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>这两种传参方式都会得到相同的结果。</p>
<p><code>uncurry()</code> 函数最为常见的作用对象很可能并不是人为生成的柯里化函数（例如上文所示），而是某些操作所产生的已经被柯里化了的结果函数。我会在后面关于 “无形参风格” 的讨论中阐述这种应用场景。</p>
<h2 id="后语"><a href="#后语" class="headerlink" title="后语"></a>后语</h2><p>在这一章节中，我主要介绍了函数式编程中两个比较重要的知识点<strong>偏应用</strong>和<strong>柯里化</strong>，彻底的理解它们，才能继续接下去的学习之路。</p>

    
    </div>
    
        
</article>
  </div>

  

<footer id="footer">
    <div class="footer-copyright">
        <div>
            <p> 版权所有 <a href="">LinDaiDai </a> @ 2019</p>
            <!--<p>设计: <i class="fas fa-paint-brush"></i> <a href="https://moober.cn">Moober</a> 和 <i class="fas fa-graduation-cap"></i> <a href="https://qutang.github.io">Qu Tang</a> &bull; 主题: <a href="https://qutang.github.io/cutie/">Cutie 2.1.3-</a> &bull; 由 <a href="http://hexo.io">Hexo.</a> 强力驱动</p>-->
        </div>
    </div>
    
    <div class="footer-social">
        
    </div>
</footer>

  <br>

  <div id="footer-nav" class='footer-nav'>
		



<nav id="nav">
	
	
	
	<div class="nav-item" id="nav-item-toc">
		


<div class="toc-container">
<i class="far fa-times-circle" id="toc-close" onclick="closeTOC(event);" ontouchstart="closeTOC(event);"></i>

</div>
<div class="toc-button" onclick="toggleTOC(event);" ontouchstart="toggleTOC(event);">
    <img src="/images/icons//toc.svg" alt="">
</div>

	</div>
	
	<div class="nav-item" id="nav-item-archive">
		
				<div class="nav-icon">
				
			<a href="/archives/" title="归档">
			<img src="/images/icons//archive.svg" alt="">
			</a>
		</div>
	</div>
	<div class="nav-item" id="nav-item-search">
		
		<div class="nav-icon">
		
			<a href="/search/" title="搜索">
			<img src="/images/icons//search.svg" alt="">
			</a>
		</div>
	</div>
	<div class="nav-item" id="nav-item-more">
		<div class="nav-icon">
				<a href="#" onclick="onClickMenuIcon(event);" ontouchstart="onClickMenuIcon(event);">
				<img src="/images/icons//menu.svg" alt="">
				</a>
		</div>
		<div class="nav-more-menu">
				<i class="far fa-times-circle" id="nav-more-menu-close" onclick="onClickNavMenuClose(event);" ontouchstart="onClickNavMenuClose(event);"></i>
		
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/php/">
						<span>Php</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/mySql/">
						<span>Mysql</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/其它技能/">
						<span>其它技能</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/vscode/">
						<span>Vscode</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/前端进阶/">
						<span>前端进阶</span>
					</a>
				</div>
		</div>
		
		<div class="nav-more-item">
				<div class="nav-name">
					<a class="nav-link" href="/categories/前端入门/">
						<span>前端入门</span>
					</a>
				</div>
		</div>
		
	</div>
	</div>
</nav>

	</div>

  












<script type="text/javascript">

  
  // update cookie if this page is opened (directly)
  loadjs(['/libs/jshashes/hashes.min.js', '/libs/js-cookie/src/js.cookie.js', '/js/post.v2.js'], 'post-version');
  loadjs.ready('post-version', function(){
    
    new Postv2('').update('', function(){});
  });
  
</script>


    
<script type="text/javascript">
  
  // update cookie if this page is opened (directly)
  function getIP(json) {
  loadjs(['/libs/jshashes/hashes.min.js', '/libs/js-cookie/src/js.cookie.js', '/js/leancloud.js'], 'post-visit-comment-count');
  loadjs.ready('post-visit-comment-count', function(){
    
    
    LeanCloud.init('', '');
    var leanCloud = LeanCloud.getInstance();
    leanCloud.fetchIsThumbUp('/2019/06/23/webNotes/advanced/Functional/ch_2/', json.ip);
    document.getElementById('thumb-up-button').addEventListener('click', function(e){
      leanCloud.isThumbUp('/2019/06/23/webNotes/advanced/Functional/ch_2/', function(isThumbUp){
        console.log('is thumb up:' + isThumbUp);
        if(isThumbUp){
          leanCloud.removeThumbUpRecord('/2019/06/23/webNotes/advanced/Functional/ch_2/', json.ip);
          document.getElementById('thumb-up-icon').className = "far fa-thumbs-up fa-lg";
          
        }else{
          leanCloud.addThumbUpRecord('/2019/06/23/webNotes/advanced/Functional/ch_2/', json.ip);
          document.getElementById('thumb-up-icon').className = "fas fa-thumbs-up fa-lg";
        }
        leanCloud.getThumbUpCount('/2019/06/23/webNotes/advanced/Functional/ch_2/', function(count){
            console.log('thumb up count: ' + count)
            var el = document.getElementById('article-thumbup-count');
            if(el) el.innerHTML = count;
        });
      });
    });
    leanCloud.addVisitRecord('/2019/06/23/webNotes/advanced/Functional/ch_2/', json.ip);
    leanCloud.fetchCommentCount('/2019/06/23/webNotes/advanced/Functional/ch_2/');
    leanCloud.fetchVisitCount('/2019/06/23/webNotes/advanced/Functional/ch_2/');
    leanCloud.fetchThumbUpCount('/2019/06/23/webNotes/advanced/Functional/ch_2/');
    leanCloud.getCommentCount('/2019/06/23/webNotes/advanced/Functional/ch_2/', function(count){
        var el = document.querySelector('#article-comment-count');
        if(el) el.innerHTML = count;
    });
    leanCloud.getVisitCount('/2019/06/23/webNotes/advanced/Functional/ch_2/', function(count){
        var el = document.querySelector('#article-visit-count');
        if(el) el.innerHTML = count;
    });
    leanCloud.getThumbUpCount('/2019/06/23/webNotes/advanced/Functional/ch_2/', function(count){
        var el = document.getElementById('article-thumbup-count');
        if(el) el.innerHTML = count;
    });
    leanCloud.isThumbUp('/2019/06/23/webNotes/advanced/Functional/ch_2/', function(isThumbUp){
        console.log('init thumb up:' + isThumbUp);
        if(isThumbUp){
          document.getElementById('thumb-up-icon').className = "fas fa-thumbs-up fa-lg";
        }else{
          document.getElementById('thumb-up-icon').className = "far fa-thumbs-up fa-lg";
        }
    });
  });
  }
  
</script>

<script type="application/javascript" src="https://api.ipify.org?format=jsonp&callback=getIP"></script>



<!-- <script src="/js/post.js"></script> -->

<script src="/js/headroom.min.js"></script>

<script data-no-instant="" type="text/javascript">

initHeadroom();

changeLayoutOnTouchScreen();

// 
// var post = new Post('', '');
// post.getCommentCount(window.location.pathname, function(count){
//     $('#article-comment-count').text(count);
// });
// post.addVisitRecord(window.location.pathname, userip);
// post.getVisitCount(window.location.pathname, function(count){
//     $('#article-visit-count').text(count);
// });

// 
</script>


<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
